## 모두의 네트워크(네트워크 전체 흐름)

해당 포스팅은 `모두의 네트워크` 책을 정리한 내용으로 네트워크 전체 흐름에 대해 다룬다.

현재까지 살펴본 각 계층별 역할은 다음과 같다.

|계층|특징|
|---|---|
|응용 계층|애플리케이션 등에서 사용하는 데이터를 송수신|
|전송 계층|목저지에 데이터를 정확하게 전달|
|네트워크 계층|다른 네트워크에 있는 목적지에 데이터를 전달|
|데이터 링크 계층|랜에서 데이터를 송수신|
|물리 계층|데이터를 전기 신호로 변환|

<br>

### 컴퓨터의 데이터가 전기 신호로 변환되는 과정
---

3-way handshake 완료한 상태라고 가정하며 상위 계층에서 내려가면서 캡슐화가 진행된다.

|순서|계층|내용|
|---|---|---|
|1|사용자|웹 브라우저에 URL을 입력한다.|
|2|응용 계층|웹 서버에 요청을 보내므로 HTTP 프로토콜로 HTTP 메시지 전송한다.
HTTP 메시지 → GET /index.html HTTP/1.1|
|3|전송 계층|TCP 헤더(출발지 포트 번호, 목적지 포트 번호..)를 붙여서 세그먼트를 만든다.
출발지 포트 번호는 잘 알려진 포트를 제외한 무작위로 설정된다.
HTTP이므로 목적지 포트 번호는 80번 포트이다.|
|4|네트워크 계층|IP 헤더(출발지 IP 주소, 목적지 IP 주소)를 붙여서 IP 패킷을 만든다.|
|5|데이터 링크 계층|이더넷 헤더와 트레일러를 붙여서 이더넷 프레임을 만든다.|
|6|물리 계층|랜 카드에서 데이터를 전기 신호로 변환한 후 전송한다.|

<br>


### 라우터 A에서의 데이터 전달과 처리
---

|순서|계층|내용|
|---|---|---|
|1|물리 계층|전기 신호로 변환된 데이터를 받는다.|
|2|데이터 링크 계층|이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교한다.
주소가 같으면 이더넷 헤더와 트레일러는 분리하는 역캡슐화를 수행한다.|
|3|네트워크 계층|목적지 IP 주소와 자신의 라우팅 테이블을 비교하여 라우팅을 수행한다.
출발지 IP 주소를 라우터 A의 외부 IP 주소(WAN)로 변경한다.|
|4|데이터 링크 계층|데이터를 라우터 B로 보내기 위해 이더넷 헤더와 트레일러를 붙인다.|
|5|물리 계층|데이터를 전기 신호로 변환하여 네트워크로 전달한다.|

<br>

### 라우터 B에서의 데이터 전달과 처리
---

|순서|계층|내용|
|---|---|---|
|1|물리 계층|전기 신호로 변환된 데이터를 받는다.|
|2|데이터 링크 계층|이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교한다.
주소가 같으면 이더넷 헤더와 트레일러는 분리하는 역캡슐화를 수행한다.|
|3|네트워크 계층|목적지 IP 주소와 자신의 라우팅 테이블을 비교하여 라우팅을 수행한다.
출발지 IP 주소를 라우터 B의 내부 IP 주소(LAN)로 변경한다.|
|4|데이터 링크 계층|데이터를 라우터 B로 보내기 위해 이더넷 헤더와 트레일러를 붙인다.|
|5|물리 계층|데이터를 전기 신호로 변환하여 네트워크로 전달한다.|

<br>

### 웹 서버에서의 데이터 전달과 처리
---

|순서|계층|내용|
|---|---|---|
|1|물리 계층|전기 신호로 변환된 데이터를 받는다.|
|2|데이터 링크 계층|이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교한다.
주소가 같으면 이더넷 헤더와 트레일러는 분리하는 역캡슐화를 수행한다.|
|3|네트워크 계층|목목적지 IP 주소와 웹 서버의 IP 주소가 같은 지 확인한다.
주소가 같으면 IP 헤더를 분리하고 데이터를 전송 계층에 전달한다.|
|4|전송 계층|목적지 포트 번호를 보고 TCP 헤더를 분리한 후 해당 포트의 애플리케이션으로 데이터를 전달한다.|
|5|응용 계층|데이터가 웹 서버에 도착한다.|
